<!-- pages/category/category.wxml -->
<view class="container">
  <!-- 桌号信息显示 -->
  <view class="table-info" wx:if="{{hasTableId}}">
    <view class="table-id">桌号: {{tableId}}</view>
  </view>

  <!-- 顶部工具栏 -->
  <view class="toolbar">
    <view class="back-btn" bindtap="backToHome">
      <text>回到首页</text>
    </view>
  </view>

  <!-- 分类与菜品列表 -->
  <view class="menu-container">
    <!-- 左侧分类列表 -->
    <scroll-view scroll-y class="category-list">
      <view 
        class="category-item {{item.id === currentCategory ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="id"
        bindtap="switchCategory"
        data-id="{{item.id}}"
      >
        <view class="category-name">{{item.name}}</view>
      </view>
    </scroll-view>
    
    <!-- 右侧菜品列表 -->
    <scroll-view 
      scroll-y 
      class="dish-list" 
      scroll-top="{{scrollTop}}"
      scroll-with-animation="true"
    >
      <!-- 加载中提示 -->
      <view class="loading" wx:if="{{isLoading}}">
        <view class="loading-icon"></view>
        <text>加载中...</text>
      </view>
      
      <!-- 空状态提示 -->
      <view class="empty-state" wx:if="{{!categories.length || !dishes.length}}">
        <view class="empty-icon">
          <icon type="info" size="45" color="#cccccc"/>
        </view>
        <view class="empty-text">{{!categories.length ? '暂无分类信息' : '暂无菜品信息'}}</view>
      </view>
      
      <!-- 菜品列表 -->
      <view class="dish-item" wx:for="{{dishes}}" wx:key="id" bindtap="onTapDish" data-id="{{item.id}}">
        <image class="dish-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="dish-info">
          <view class="dish-name">{{item.name}}</view>
          <view class="dish-desc" wx:if="{{item.description}}">{{item.description}}</view>
          <view class="dish-price-action">
            <view class="dish-price price">{{item.price}}</view>
            <view class="dish-add" catchtap="onAddToCart" data-index="{{index}}">
              <view class="add-icon">+</view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 底部安全区域 -->
      <view class="safe-bottom-area"></view>
    </scroll-view>
  </view>
  
  <!-- 购物车组件 -->
  <cart-bar id="cartBar" table-id="{{tableId}}"></cart-bar>
  
  <!-- 规格选择对话框 -->
  <view class="spec-dialog-mask" wx:if="{{showSpecDialog}}" bindtap="closeSpecDialog">
    <view class="spec-dialog" catchtap="stopEvent">
      <view class="spec-dialog-header">
        <view class="spec-dialog-title">{{currentDish.name}}</view>
        <view class="spec-dialog-close" bindtap="closeSpecDialog">×</view>
      </view>
      <view class="spec-dialog-content">
        <view class="spec-dialog-subtitle">请选择规格</view>
        <view class="spec-list">
          <view 
            class="spec-item {{selectedSpecIndex === index ? 'active' : ''}}" 
            wx:for="{{currentDish.specifications}}" 
            wx:key="id"
            bindtap="selectSpecification"
            data-index="{{index}}"
          >
            <view class="spec-name">{{item.name}}</view>
            <view class="spec-price">¥{{item.price}}</view>
          </view>
        </view>
      </view>
      <view class="spec-dialog-footer">
        <button class="add-cart-btn" bindtap="confirmAddToCart">加入购物车</button>
      </view>
    </view>
  </view>
</view>

<!-- 防止事件冒泡的辅助函数 -->
<wxs module="stopEvent">
module.exports = function(e) {
  e.stopPropagation();
  return false;
}
</wxs> 